# 答题卡

## 1 总训练时间与理想时间

### 1.1

按照 GPipe 调度，记流水线阶段数 $p=4$，微批次数 $m=8$，单个微批次的前向和反向时间分别为 $t_f=2\text{ ms}$、$t_b=4\text{ ms}$。由可得流水线气泡时间
$$
t_{pb}=(p-1)\cdot(t_f+t_b)=(4-1)\times(2+4)=18\text{ ms}
$$
而理想处理时间
$$t_{id}=m\cdot(t_f+t_b)=8\times6=48\text{ ms}
$$
因此总执行时间
$$
T_{\text{total}}=t_{id}+t_{pb}=(m+(p-1))(t_f+t_b)=(8+3)\times6=66\text{ ms}.
$$

### 1.2

理想情况下若无气泡，每个微批次顺序前后传播都不等待，总时间为
$$
T_{\text{ideal}}=m\,(t_f+t_b)=8\times(2+4)=48\text{ ms}
$$。

### 1.3

$$
\text{Bubble Ratio}=\frac{66}{48}\approx1.375
$$

## 2 若将 microbatch 数增加为 $m = 16$，bubble ratio 会如何变化？请分析并说明原因

若 $m=16$，则
$$
\begin{aligned}
	&T_{\text{total}}=(16+3)\times6=114\text{ ms}\\
	&T_{\text{ideal}}=16\times6=96\text{ ms}
\end{aligned}
$$
泡沫比
$$
114/96\approx1.1875
$$
与 $m=8$ 时相比，泡沫比下降了，这是因为微批次数越多，流水线填充得越满，固定的流水线开销（$p-1$）在更多微批上摊薄，效率提高。

## 3. 与 Gpipe 相比，1F1B 调度策略在哪些方面优化了流水线利用率？
> 1F1B（One-Forward-One-Backward）调度将前向和后向传递交替执行，减少流水线尾部和开头的空闲时段。在进入稳态后，每个阶段在处理一个微批次的前向后立即执行该批次的反向，从而更早释放激活并降低峰值内存使用。与 GPipe 的 “先全前向后全反向” 不同，1F1B 在流水线里程碑（flush）期间硬件利用率更高。研究表明，在保持相同微批数的情况下，1F1B 调度可以达到与 GPipe 近似的泡沫比，但具有更低的峰值内存开销。因此，相比 GPipe，1F1B 调度通过前后向的交替并行大大提高了流水线的利用率（填充了原本的“气泡”），并且对内存需求更友好。
