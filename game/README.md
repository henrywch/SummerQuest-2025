# Game

这是一款旨在帮助高中生巩固高考语文知识的成语卡牌对战游戏，亦是我们暑期编程集训的实践项目。

## 游戏规则

### 1. 核心组件

🃏 **卡牌构成**
- **名称区**：标识成语，如「卧薪尝胆」。
- **效果区**：标注特殊能力图标，如🛡️（反击）或⚡（连击）。
- **验证区**：卡牌背面载明该成语的标准释义与典故出处。

📚 **游戏区域**
- **牌库区**：双方共用，含 `2 * M` 张卡牌（M=20）。
- **手牌区**：各玩家独立持有，开局抽取 `N` 张（N=5），此后每回合补充一张。
- **得分区**：各玩家独立计分。成功打出（释义正确）的卡牌归入此区。
- **弃牌区**：双方共用。打出失败（释义错误）的卡牌归入此区。

### 2. 回合流程

🔁 **阶段划分**
1.  **准备阶段**：当前玩家从牌库补充一张手牌。
2.  **行动阶段**：
    - **主攻**：玩家打出一张普通卡牌。
    - **响应**：对方可选择发动一张带有🛡️标记的卡牌进行反击。
    - **连击**：若对方未反击，主动方可追加打出一张带有⚡标记的卡牌。
3.  **结算阶段**：
    - **释义裁定**：卡牌打出时，对方玩家依据其背面的标准释义进行裁定。若正确，卡牌置入出牌方的得分区；若错误，则置入弃牌区。
    - **典故裁定**：仅当释义正确后，继续裁定典故。若典故亦正确，则触发卡牌的特殊效果。

### 3. 特效机制

⚔️ **反击规则 (🛡️)**
- **触发条件**：必须在对方打出卡牌后立即发动。
- **结算**：反击时需同时成功口述释义与典故，成功则卡牌进入得分区并触发效果；任一失败则卡牌直接进入弃牌区。
- **目标**：可响应普通卡及连击卡。

🔗 **连击规则 (⚡)**
- **触发条件**：当自己打出的卡牌成功结算（对方未反击或反击失败）后，可立即追加打出。
- **结算**：作为一次独立的出牌进行结算。

### 4. 胜负体系

🏆 **判定时机**
- **即时胜利**：任意玩家的得分区卡牌数达到 `L` 张（L=10）。
- **牌库耗尽**：任一玩家在准备阶段无法补充手牌。

🕑 **终局裁定**
当触发终局判定时，按以下顺序决定胜负：
1.  比较双方得分区的卡牌数量，多者获胜。
2.  若数量相等，则比较双方手牌数量，多者获胜。
3.  若仍平局，则由对局中的后手玩家获胜。

## 游戏开发

### 服务器+展示器

使用 Python 编程，可以开启一局游戏，双方玩家分别通过网络连接到服务器，服务器负责管理游戏流程和数据同步。展示器则作为游戏的可视化界面，用于展示游戏画面和玩家操作。


### 手动玩家
使用 Python 编写的手动玩家脚本，玩家通过命令行交互界面与展示器进行游戏。玩家需要输入指令，如选择出牌、输入释义、选择回应卡牌等，以与展示器进行沟通。

### 自动玩家

使用 Python 编写的自动玩家脚本，玩家通过算法逻辑自动决策出牌和回应。玩家根据游戏规则和当前游戏状态，编写算法来选择最优的出牌策略和回应策略，以获得最大的胜率。

## 技术规范

### 卡牌数据结构

#### 1. 卡牌类型定义

```python
class CardType(Enum):
    NORMAL = "normal"      # 普通卡牌 📄
    COUNTER = "counter"    # 反击卡牌 🛡️
    COMBO = "combo"        # 连击卡牌 ⚡
```

#### 2. 游戏区域标识

```python
class GameZone(Enum):
    H = "deck"        # 牌库区 (Heap)
    P1 = "player1"    # 用卡玩家的手牌区 (Player 1)
    P2 = "player2"    # 对方的手牌区 (Player 2)
    S1 = "score1"     # 用卡玩家的得分区 (Score 1)
    S2 = "score2"     # 对方的得分区 (Score 2)
    A = "discard"     # 弃牌区 (Abandon)
```

### 效果系统设计

#### 1. IF条件效果

用于判断后续效果的发动前提，返回值为0或1。只有返回值是1时，才会继续执行后续的效果。

**格式**：`(A, op, B)`
- **A, B**：操作数，可以是游戏区域标识（H, P1, P2, S1, S2, A）或整数常数
- **op**：比较操作符，支持 `>`, `>=`, `<`, `<=`, `=`, `!=`

**示例**：
- `(S1, >=, 3)`：判断用卡玩家得分区是否有3张或以上卡牌
- `(P2, <, P1)`：判断对方手牌数是否少于己方手牌数

#### 2. ACTION动作效果

表示卡牌的移动方向和方式，用四元组表示：`(from, to, num, type)`

**参数说明**：
- **from**：源区域（H, P1, P2, S1, S2, A之一）
- **to**：目标区域（H, P1, P2, S1, S2, A之一）
- **num**：移动卡牌数量（正整数）
- **type**：动作类型
  - `"order"`：按顺序取牌（如从牌库顶部抽取）
  - `"select"`：选择特定卡牌
  - `"random"`：随机取牌

**示例**：
- `(H, P1, 1, "order")`：从牌库抽取第一张卡到己方手牌
- `(P2, P1, 1, "select")`：挑选对方的一张手牌放入己方手牌
- `(S2, P1, 1, "random")`：随机从对方的得分区获得一张卡到己方手牌

#### 3. 效果链执行

卡牌的效果由一个数组表示，数组中的每个元素表示一个效果，按顺序执行：

```python
# 示例：复杂效果卡牌
effects = [
    IfCondition(S1, OperatorType.GTE, 2),        # 如果己方得分区>=2张卡
    ActionEffect(H, P1, 1, ActionType.ORDER),    # 则从牌库抽1张卡
    IfCondition(P2, OperatorType.GT, 0),         # 如果对方有手牌
    ActionEffect(P2, A, 1, ActionType.SELECT)    # 则选择对方1张手牌丢弃
]
```

### 卡牌类结构

```python
@dataclass
class Card:
    id: int                    # 卡牌唯一标识
    name: str                  # 卡牌名称（成语）
    meaning: str               # 成语释义
    story: str                 # 典故出处
    card_type: CardType        # 卡牌类型
    effects: List[CardEffect]  # 卡牌效果列表
```

所有卡牌效果必须能够用上述IF条件和ACTION动作的组合来表示，确保游戏逻辑的一致性和可扩展性。